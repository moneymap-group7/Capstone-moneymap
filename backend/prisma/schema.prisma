generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId       BigInt        @id @default(autoincrement())
  fullName     String        @db.VarChar(100)
  email        String        @unique @db.VarChar(254)
  passwordHash String
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  lastLoginAt  DateTime?
  transactions Transaction[]

  @@map("users")
}

model Transaction {
  transactionId   BigInt            @id @default(autoincrement())
  userId          BigInt
  transactionDate DateTime
  postedDate      DateTime?
  description     String            @db.VarChar(255)
  amount          Decimal           @db.Decimal(12, 2)
  currency        String            @default("CAD") @db.Char(3)
  transactionType TransactionType
  source          TransactionSource @default(CSV)
  balanceAfter    Decimal?          @db.Decimal(12, 2)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  cardLast4       String?           @db.Char(4)
  spendCategory   SpendCategory     @default(UNCATEGORIZED)
  user            User              @relation(fields: [userId], references: [userId])

  @@index([userId])
  @@index([transactionDate])
  @@index([spendCategory])
  @@index([cardLast4])
  @@map("transactions")
}

model BankCategoryRule {
  id            Int           @id @default(autoincrement())
  bank          String
  matchText     String
  spendCategory SpendCategory
  priority      Int           @default(100)
  createdAt     DateTime      @default(now())

  @@index([bank])
  @@index([matchText])
  @@index([spendCategory])
  @@index([priority])
  @@map("bank_category_rules")
}

enum TransactionType {
  DEBIT
  CREDIT
}

enum TransactionSource {
  CSV
}

enum SpendCategory {
  FOOD_AND_DINING
  GROCERIES
  TRANSPORTATION
  SHOPPING
  UTILITIES
  RENT
  ENTERTAINMENT
  HEALTH
  EDUCATION
  TRAVEL
  FEES
  INCOME
  TRANSFER
  OTHER
  UNCATEGORIZED
}
